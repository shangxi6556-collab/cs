<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>币安红包 - 持10000枚才能抢 BNB</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.13.1/dist/ethers.umd.min.js"></script>
<style>
  body { margin:0; background:linear-gradient(135deg,#ff3b3b,#ffb800); color:white; font-family:'Microsoft YaHei'; min-height:100vh; display:flex; align-items:center; justify-content:center; }
  .box { background:rgba(0,0,0,0.25); backdrop-filter:blur(15px); padding:40px; border-radius:30px; width:90%; max-width:500px; text-align:center; }
  h1 { font-size:36px; margin:0 0 20px; }
  .timer { font-size:70px; font-weight:bold; margin:30px 0; text-shadow:0 0 20px #000; }
  .hold { font-size:24px; margin:20px 0; padding:15px; background:#c62828; border-radius:20px; }
  button { width:85%; padding:20px; font-size:28px; background:#e74c3c; border:none; border-radius:60px; margin:15px 0; cursor:pointer; }
  button:disabled { background:#666; cursor:not-allowed; }
  .warn { color:#ff1744; font-size:22px; font-weight:bold; margin:15px 0; }
</style>
</head>
<body>
<div class="box">
  <h1>币安红包 </h1>
<h1> BNB RED PACKET</h1>
  <div id="status">点击连接钱包</div>
  <div class="timer" id="timer">00:00:00</div>
  <div class="info">本轮红包总额：<b id="amount">0</b> BNB</div>
  <div class="info">剩余名额：<b id="slots">0</b> 个</div>

  <!-- 持币检测提示区 -->
  <div id="holdInfo" class="hold" id="holdInfo">检测中...</div>


  <button id="connectBtn">连接 MetaMask</button>
  <button id="claimBtn" disabled>立即抢红包</button>
</div>

<script>
// ←←←← 唯一要改的地方：填你部署的红包池地址 ←←←←
const POOL_ADDRESS = "0xbCfDA13c51fb56ED877a541fC7394E01Bc166313";          // ← 改这里
// ←←←← 第二行要改：你的代币地址（Flap上线后自动有） ←←←←
const TOKEN_ADDRESS = "0x986540c77eaf8385b5c9a85caf68eca10f7e4444";           // ← 改这里
  }
}

const POOL_ABI = ["function claim()","function roundStartTime() view returns (uint256)","function remainingSlots() view returns (uint256)"];
const TOKEN_ABI = ["function balanceOf(address) view returns (uint256)","function decimals() view returns (uint8)"];

let provider, signer, poolContract, tokenContract, account;

async function connect() {
  if (!window.ethereum) return alert("请安装 MetaMask！");
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = await provider.getSigner();
  account = await signer.getAddress();

  poolContract = new ethers.Contract(POOL_ADDRESS, POOL_ABI, signer);
  tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, provider);

  document.getElementById("status").textContent = `已连接 ${account.slice(0,6)}...${account.slice(-4)}`;
  document.getElementById("connectBtn").disabled = true;
  updateAll();
  setInterval(updateAll, 3000);
}

// 实时检测持币数量
async function checkHold() {
  if (!tokenContract || !account) {
    document.getElementById("holdInfo").textContent = "请先连接钱包";
    return false;
  }
  const bal = await tokenContract.balanceOf(account);
  const hold = Number(ethers.formatUnits(bal, 18));

  if (hold >= 10000) {
    document.getElementById("holdInfo").style.background = "#2e7d32";
    document.getElementById("holdInfo").textContent = `已持币 ${hold.toFixed(2)} 枚 ✅ 可抢红包`;
    document.getElementById("claimBtn").disabled = false;
    return true;
  } else {
    document.getElementById("holdInfo").style.background = "#c62828";
    document.getElementById("holdInfo").innerHTML = `当前持有 ${hold.toFixed(2)} 枚<br><span class="warn">持有 ≥ 10,000 枚代币才可抢！</span>`;
    document.getElementById("claimBtn").disabled = true;
    return false;
  }
}

async function claim() {
  if (!(await checkHold())) return;
  document.getElementById("claimBtn").disabled = true;
  try {
    const tx = await poolContract.claim();
    await tx.wait();
    alert("恭喜发财！BNB 已到账！");
    updateAll();
  } catch (e) {
    alert("抢失败：" + (e.reason || e.message));
    document.getElementById("claimBtn").disabled = false;
  }
}

async function updateAll() {
  await checkHold();
  // 其他倒计时、余额等逻辑略（你原来的代码直接粘进来就行）
}

document.getElementById("connectBtn").onclick = connect;
document.getElementById("claimBtn").onclick = claim;
</script>
</body>
</html>